<!DOCTYPE html><html lang="id" class="light"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Realtime Translator</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><script>tailwind.config={darkMode:"class",theme:{extend:{fontFamily:{sans:["Poppins","sans-serif"]},colors:{brand:{blue:"#3b82f6",purple:"#8b5cf6",dark:"#1e293b"}}}}};</script><style>@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap);.recording-pulse{animation:pulse-ring 1.5s cubic-bezier(.4,0,.6,1) infinite}@keyframes pulse-ring{0%{box-shadow:0 0 0 0 rgba(239,68,68,.7)}70%{box-shadow:0 0 0 15px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}.chat-scroll::-webkit-scrollbar{width:4px}.chat-scroll::-webkit-scrollbar-thumb{background-color:#cbd5e1;border-radius:4px}.dark .chat-scroll::-webkit-scrollbar-thumb{background-color:#4b5563}textarea{transition:height .1s}</style></head><body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 font-sans h-[100dvh] flex flex-col overflow-hidden transition-colors duration-200"><header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm z-30 shrink-0 transition-colors duration-200"><div class="flex items-center justify-between p-3"><div class="flex items-center gap-3"><a href="/" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"><i class="fas fa-arrow-left text-gray-600 dark:text-gray-300"></i> </a><span class="font-bold text-gray-700 dark:text-gray-200 text-sm md:text-base">Lobby</span></div><div class="flex items-center gap-2"><button onclick="handleRefresh();
" class="w-8 h-8 flex items-center justify-center rounded-full bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/40 transition-colors" title="Refresh Connection"><i class="fas fa-sync-alt"></i></button> <button onclick="handleClear();
" class="w-8 h-8 flex items-center justify-center rounded-full bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors" title="Hapus Semua Chat Permanen"><i class="fas fa-trash"></i></button> <button id="themeToggle" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"><i class="fas fa-moon dark:hidden"></i> <i class="fas fa-sun hidden dark:block"></i></button> <img id="headerAvatar" src="" class="w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 hidden object-cover"> <button id="logoutBtn" onclick="handleLogout();
" class="hidden w-8 h-8 flex items-center justify-center rounded-full bg-red-50 dark:bg-red-900/20 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors" title="Logout"><i class="fas fa-sign-out-alt"></i></button></div></div><div id="settingsBar" class="grid grid-cols-2 gap-0 border-t border-gray-100 dark:border-gray-700 divide-x divide-gray-100 dark:divide-gray-700 hidden transition-all"><div class="p-2 bg-blue-50/50 dark:bg-blue-900/20"><label class="block text-[10px] uppercase font-bold text-blue-600 dark:text-blue-400 mb-1 tracking-wider"><i class="fas fa-microphone mr-1"></i> Your Language</label> <select id="myLang" class="w-full bg-transparent font-semibold text-sm outline-none text-gray-800 dark:text-gray-200"><option value="id-ID" class="dark:bg-gray-800">ğŸ‡®ğŸ‡© Indonesia</option><option value="en-US" class="dark:bg-gray-800">ğŸ‡ºğŸ‡¸ English</option><option value="ja-JP" class="dark:bg-gray-800">ğŸ‡¯ğŸ‡µ Japanese</option><option value="ko-KR" class="dark:bg-gray-800">ğŸ‡°ğŸ‡· Korean</option><option value="zh-CN" class="dark:bg-gray-800">ğŸ‡¨ğŸ‡³ Mandarin</option><option value="my-MM" class="dark:bg-gray-800">ğŸ‡²ğŸ‡² Myanmar</option><option value="th-TH" class="dark:bg-gray-800">ğŸ‡¹ğŸ‡­ Thai</option></select></div><div class="p-2 bg-purple-50/50 dark:bg-purple-900/20"><label class="block text-[10px] uppercase font-bold text-purple-600 dark:text-purple-400 mb-1 tracking-wider"><i class="fas fa-language mr-1"></i> Your Friends</label> <select id="targetLang" class="w-full bg-transparent font-semibold text-sm outline-none text-gray-800 dark:text-gray-200"><option value="ja" selected="selected" class="dark:bg-gray-800">ğŸ‡¯ğŸ‡µ Japanese</option><option value="en" class="dark:bg-gray-800">ğŸ‡ºğŸ‡¸ English</option><option value="id" class="dark:bg-gray-800">ğŸ‡®ğŸ‡© Indonesia</option><option value="ko" class="dark:bg-gray-800">ğŸ‡°ğŸ‡· Korean</option><option value="zh" class="dark:bg-gray-800">ğŸ‡¨ğŸ‡³ Mandarin</option><option value="my" class="dark:bg-gray-800">ğŸ‡²ğŸ‡² Myanmar</option><option value="th" class="dark:bg-gray-800">ğŸ‡¹ğŸ‡­ Thai</option><option value="fr" class="dark:bg-gray-800">ğŸ‡«ğŸ‡· French</option></select></div></div></header><main class="flex-1 relative flex flex-col w-full max-w-lg mx-auto bg-white dark:bg-gray-800 shadow-lg overflow-hidden h-full transition-colors duration-200"><section id="loginSection" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-white dark:bg-gray-900 p-6 text-center transition-colors duration-200"><h2 class="text-2xl font-bold mb-2 text-gray-800 dark:text-white">Welcome!</h2><p class="text-gray-500 dark:text-gray-400 mb-8 text-sm max-w-xs mx-auto">Please login first!</p><button id="googleLoginBtn" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 px-6 py-3 rounded-xl shadow-md flex items-center gap-3 font-medium active:scale-95 transition-transform hover:bg-gray-50 dark:hover:bg-gray-700 w-full max-w-xs justify-center"><img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> <span>Signin with google</span></button></section><section id="dashboardSection" class="absolute inset-0 z-40 flex flex-col items-center justify-center bg-white dark:bg-gray-900 p-6 hidden transition-colors duration-200"><div class="w-full max-w-sm bg-white dark:bg-gray-800 rounded-3xl border border-gray-200 dark:border-gray-700 shadow-xl p-6 text-center"><div class="mb-4"><h3 id="dashName" class="font-bold text-lg text-gray-800 dark:text-white">Hi, User</h3><p class="text-xs text-gray-400">Scan for join the room!</p></div><div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl mb-4 flex items-center justify-center min-h-[220px] border border-gray-100 dark:border-gray-600 relative"><div id="qrLoader" class="text-blue-500 absolute"><i class="fas fa-circle-notch fa-spin text-3xl"></i></div><img id="qrImage" src="" class="w-48 h-48 object-contain hidden mix-blend-multiply dark:mix-blend-normal z-10"></div><div class="space-y-3"><button onclick="copyRoomLink();
" class="w-full py-3 rounded-xl bg-blue-600 text-white text-sm font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition-all flex items-center justify-center gap-2"><i class="fas fa-link"></i> Salin Link</button> <button onclick="enterRoomSelf();
" class="w-full py-3 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-200 text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 active:scale-95 transition-all">Masuk ke Room</button></div></div></section><section id="chatSection" class="flex-1 flex flex-col relative hidden h-full"><div id="messagesContainer" class="flex-1 overflow-y-auto p-4 space-y-4 chat-scroll pb-20 bg-gray-50 dark:bg-gray-900 transition-colors duration-200"><div id="emptyState" class="text-center mt-20 opacity-40"><i class="fas fa-microphone-lines text-gray-400 dark:text-gray-600 text-4xl mb-3"></i><p class="text-sm text-gray-500 dark:text-gray-400">Mulai bicara atau ketik untuk menerjemahkan</p></div><div id="typingIndicator" class="hidden flex gap-2 mb-4 items-end animate-fade-in transition-all duration-300"><div class="px-4 py-3 rounded-2xl rounded-bl-none bg-gray-200 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 flex gap-1.5 items-center shadow-sm"><div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"></div><div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce [animation-delay:0.4s]"></div></div><span class="text-xs text-gray-400 dark:text-gray-500 mb-1 italic">Typing...</span></div></div><div id="loadingOverlay" class="absolute bottom-24 left-1/2 -translate-x-1/2 hidden z-40 transition-all"><div class="bg-gray-800/90 dark:bg-white/90 backdrop-blur-sm text-white dark:text-gray-800 px-4 py-2 rounded-full text-xs font-medium flex items-center gap-2 shadow-xl border border-white/10 dark:border-gray-200"><i class="fas fa-spinner fa-spin text-blue-400 dark:text-blue-600"></i> <span>Menerjemahkan...</span></div></div><div class="bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 p-3 z-30 shrink-0 shadow-[0_-5px_15px_rgba(0,0,0,0.02)] flex items-end gap-2 transition-colors duration-200"><div class="flex-1 bg-gray-100 dark:bg-gray-700 rounded-[24px] flex items-center px-4 py-2 border border-transparent focus-within:border-blue-400 focus-within:bg-white dark:focus-within:bg-gray-800 transition-all"><textarea id="chatInput" rows="1" class="bg-transparent w-full outline-none text-sm text-gray-700 dark:text-gray-200 resize-none max-h-24 py-1 custom-scroll leading-relaxed" placeholder="Ketik pesan..."></textarea></div><button id="sendBtn" class="w-12 h-12 rounded-full bg-blue-600 text-white shadow-lg shadow-blue-500/30 flex items-center justify-center active:scale-90 transition-all shrink-0 hidden hover:bg-blue-700"><i class="fas fa-paper-plane text-lg translate-x-[-1px] translate-y-[1px]"></i></button> <button id="recordBtn" class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg shadow-blue-500/30 flex items-center justify-center active:scale-90 transition-all shrink-0 select-none touch-manipulation cursor-pointer"><i class="fas fa-microphone text-lg"></i></button></div></section></main><div id="guideModal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden transition-opacity duration-300"><div class="bg-white dark:bg-gray-800 w-11/12 max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[85vh] transform transition-all scale-100 border border-gray-100 dark:border-gray-700"><div class="p-5 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 rounded-t-2xl"><h3 class="font-bold text-lg text-gray-800 dark:text-white flex items-center gap-2"><i class="fas fa-book-open text-blue-500"></i>Tutorial</h3><button onclick="closeGuide();
" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors"><i class="fas fa-times text-xl"></i></button></div><div class="p-6 overflow-y-auto space-y-6 text-sm text-gray-600 dark:text-gray-300 custom-scrollbar"><div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800/30"><h4 class="font-semibold text-blue-700 dark:text-blue-300 mb-2">Welcome to realtime conversation</h4><p class="leading-relaxed">This feature connects two users (e.g., you & a Foreign Friend) via QR Code Scan. The system will automatically translate the two-way conversation.</p></div><div><h4 class="font-semibold text-gray-800 dark:text-gray-100 mb-3 border-l-4 border-purple-500 pl-3">For example :</h4><div class="space-y-4 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px md:before:mx-auto md:before:translate-x-0 before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-gray-300 before:to-transparent"><div class="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active"><div class="flex items-center justify-center w-10 h-10 rounded-full border border-white bg-red-100 shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2 z-10"><span class="text-red-600 font-bold">A</span></div><div class="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] p-3 rounded-xl bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600 shadow-sm"><div class="font-bold text-gray-900 dark:text-white mb-1">Japanese friends ğŸ‡¯ğŸ‡µ</div><div class="text-xs italic mb-1">"ä»Šæ—¥ã¯ä½•ã—ã¦ã‚‹ã®ï¼Ÿ"</div><div class="text-[10px] text-gray-500 dark:text-gray-400">Voice â†’ Text â†’ Translate</div></div></div><div class="flex justify-center w-full -my-2 relative z-0"><i class="fas fa-arrow-down text-gray-300 text-xs"></i></div><div class="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active"><div class="flex items-center justify-center w-10 h-10 rounded-full border border-white bg-green-100 shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2 z-10"><span class="text-green-600 font-bold">B</span></div><div class="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800"><div class="font-bold text-gray-900 dark:text-white mb-1">received by you ğŸ‡®ğŸ‡©</div><div class="text-xs font-medium text-blue-600 dark:text-blue-300">"Lagi apa hari ini?"</div><div class="text-[10px] text-gray-500 dark:text-gray-400">The translation result will appear for your Japanese friend.</div></div></div><div class="flex justify-center w-full -my-2 relative z-0"><i class="fas fa-arrow-down text-gray-300 text-xs"></i></div><div class="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active"><div class="flex items-center justify-center w-10 h-10 rounded-full border border-white bg-green-100 shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2 z-10"><span class="text-green-600 font-bold">B</span></div><div class="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] p-3 rounded-xl bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-600 shadow-sm"><div class="font-bold text-gray-900 dark:text-white mb-1">Your Message ğŸ‡®ğŸ‡©</div><div class="text-xs italic mb-1">"Aku sedang belajar."</div><div class="text-[10px] text-gray-500 dark:text-gray-400">Translate: "ç§ã¯å‹‰å¼·ã—ã¦ã„ã¾ã™"</div></div></div></div></div><div class="bg-orange-50 dark:bg-orange-900/20 p-3 rounded-lg flex gap-3 items-start border border-orange-100 dark:border-orange-800/30"><i class="fas fa-lightbulb text-orange-500 mt-1"></i><div><span class="font-bold text-orange-700 dark:text-orange-400 text-xs block mb-1">Tips:</span><p class="text-xs text-gray-600 dark:text-gray-400">Make sure your internet connection is stable and smooth. Happy translation!</p></div></div></div><div class="p-5 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 rounded-b-2xl"><button onclick="closeGuide();
" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl shadow-lg shadow-blue-500/30 transition-all active:scale-95">Let's started</button></div></div></div><script>function showGuideModal(){const e=document.getElementById("guideModal");e&&(e.classList.remove("hidden"),setTimeout(()=>{e.firstElementChild.classList.remove("scale-95","opacity-0"),e.firstElementChild.classList.add("scale-100","opacity-100")},10))}function closeGuide(){const e=document.getElementById("guideModal");e&&(e.firstElementChild.classList.remove("scale-100","opacity-100"),e.firstElementChild.classList.add("scale-95","opacity-0"),setTimeout(()=>{e.classList.add("hidden")},300),localStorage.setItem("realtime_guide_seen","true"))}document.addEventListener("DOMContentLoaded",()=>{localStorage.getItem("realtime_guide_seen")!=="true"&&showGuideModal()});</script><script type="module">var f=(t,n,s)=>new Promise((i,a)=>{var o=m=>{try{p(s.next(m))}catch(b){a(b)}},g=m=>{try{p(s.throw(m))}catch(b){a(b)}},p=m=>m.done?i(m.value):Promise.resolve(m.value).then(o,g);p((s=s.apply(t,n)).next())});import{initializeApp as R}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getAuth as H,signInWithPopup as M,signOut as A,GoogleAuthProvider as q,onAuthStateChanged as D}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import{getDatabase as O,ref as u,push as j,onChildAdded as N,onChildRemoved as P,remove as w,serverTimestamp as U,set as G,onValue as K,onDisconnect as J}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";const l=document.documentElement,Y=document.getElementById("themeToggle");function z(){localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?l.classList.add("dark"):l.classList.remove("dark")}Y.addEventListener("click",()=>{l.classList.toggle("dark"),localStorage.theme=l.classList.contains("dark")?"dark":"light"}),z();const Q={apiKey:"AIzaSyBrTCPosHt9RIOpAMfxgOqCuDqJEd746lc",authDomain:"projects-language.firebaseapp.com",databaseURL:"https://projects-language-default-rtdb.firebaseio.com",projectId:"projects-language",storageBucket:"projects-language.firebasestorage.app",messagingSenderId:"764367056230",appId:"1:764367056230:web:84817b2427c435a63c2ca7",measurementId:"G-938GHYDMCL"},C=R(Q),B=H(C),h=O(C),V=new q;let d=null,r=null,c=null,y=!1,v=!1,T=null,x=null,k=null,I=null;const e={loginSection:document.getElementById("loginSection"),dashboardSection:document.getElementById("dashboardSection"),chatSection:document.getElementById("chatSection"),settingsBar:document.getElementById("settingsBar"),loginBtn:document.getElementById("googleLoginBtn"),logoutBtn:document.getElementById("logoutBtn"),headerAvatar:document.getElementById("headerAvatar"),dashName:document.getElementById("dashName"),qrLoader:document.getElementById("qrLoader"),qrImage:document.getElementById("qrImage"),messages:document.getElementById("messagesContainer"),emptyState:document.getElementById("emptyState"),recordBtn:document.getElementById("recordBtn"),sendBtn:document.getElementById("sendBtn"),chatInput:document.getElementById("chatInput"),loadingOverlay:document.getElementById("loadingOverlay"),myLang:document.getElementById("myLang"),targetLang:document.getElementById("targetLang")};D(B,t=>{if(d=t,t){e.loginSection.classList.add("hidden"),e.headerAvatar.src=t.photoURL,e.headerAvatar.classList.remove("hidden"),e.logoutBtn.classList.remove("hidden");const s=new URLSearchParams(window.location.search).get("room");s?S(s):W()}else e.loginSection.classList.remove("hidden"),e.dashboardSection.classList.add("hidden"),e.chatSection.classList.add("hidden"),e.settingsBar.classList.add("hidden"),e.headerAvatar.classList.add("hidden"),e.logoutBtn.classList.add("hidden"),e.messages.innerHTML=""}),e.loginBtn.onclick=()=>M(B,V).catch(t=>Swal.fire("Login Gagal",t.message,"error")),window.handleLogout=()=>{Swal.fire({title:"Keluar?",text:"Anda akan keluar dari sesi ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Keluar",cancelButtonText:"Batal",background:l.classList.contains("dark")?"#1f2937":"#fff",color:l.classList.contains("dark")?"#f3f4f6":"#000"}).then(t=>{t.isConfirmed&&A(B).then(()=>{window.location.href="/"})})},window.handleRefresh=()=>{if(!r)return;e.messages.innerHTML="",e.messages.appendChild(e.emptyState),e.emptyState.style.display="block",S(r);const t=document.querySelector('button[onclick="handleRefresh()"] i');t&&(t.classList.add("fa-spin"),setTimeout(()=>t.classList.remove("fa-spin"),1e3))},window.handleClear=()=>{r&&Swal.fire({title:"Hapus Semua Chat?",text:"Pesan akan terhapus PERMANEN untuk SEMUA ORANG di room ini.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus Semua",cancelButtonText:"Batal",background:l.classList.contains("dark")?"#1f2937":"#fff",color:l.classList.contains("dark")?"#f3f4f6":"#000"}).then(t=>f(null,null,function*(){if(t.isConfirmed)try{yield w(u(h,`rooms/${r}/messages`)),e.messages.innerHTML="",e.messages.appendChild(e.emptyState),e.emptyState.style.display="block",Swal.fire({icon:"success",title:"Terhapus",text:"Room chat telah dibersihkan.",timer:1500,showConfirmButton:!1,background:l.classList.contains("dark")?"#1f2937":"#fff",color:l.classList.contains("dark")?"#f3f4f6":"#000"})}catch(n){Swal.fire("Error",n.message,"error")}}))};function W(){return f(this,null,function*(){e.dashboardSection.classList.remove("hidden"),e.chatSection.classList.add("hidden"),e.dashName.textContent=`Hi, ${d.displayName.split(" ")[0]}`,r||(r="RM-"+Math.random().toString(36).substr(2,6).toUpperCase());const t=`${window.location.origin}/realtime-translation?room=${r}`;try{const s=yield(yield fetch("/api/generate-qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:t})})).json();s.qrImage&&(e.qrImage.src=s.qrImage,e.qrImage.classList.remove("hidden"),e.qrLoader.classList.add("hidden"))}catch(n){console.error("QR Error",n)}})}window.copyRoomLink=()=>{const t=`${window.location.origin}/realtime-translation?room=${r}`;navigator.clipboard.writeText(t),Swal.fire({toast:!0,position:"top",icon:"success",title:"Link Room Disalin!",showConfirmButton:!1,timer:1500})},window.enterRoomSelf=()=>{const t=`${window.location.pathname}?room=${r}`;window.history.pushState({path:t},"",t),S(r)};function S(t){r=t,e.dashboardSection.classList.add("hidden"),e.chatSection.classList.remove("hidden"),e.settingsBar.classList.remove("hidden"),e.settingsBar.classList.add("grid"),e.chatInput.addEventListener("keydown",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),L())}),k&&k(),I&&I(),x&&x();let n=document.getElementById("typingIndicator");n?n.remove():(n=document.createElement("div"),n.id="typingIndicator",n.className="hidden flex gap-2 mb-4 items-end animate-fade-in transition-all duration-300",n.innerHTML=`
                    <div class="px-4 py-3 rounded-2xl rounded-bl-none bg-gray-200 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 flex gap-1.5 items-center shadow-sm">
                        <div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce [animation-delay:0.2s]"></div>
                        <div class="w-2 h-2 bg-gray-400 dark:bg-gray-400 rounded-full animate-bounce [animation-delay:0.4s]"></div>
                    </div>
                    <span class="text-xs text-gray-400 dark:text-gray-500 mb-1 italic">Typing...</span>
                `),e.messages.innerHTML="",e.messages.appendChild(e.emptyState),e.messages.appendChild(n);const s=u(h,`rooms/${t}/messages`);k=N(s,a=>{const o=a.val();o&&(e.emptyState.style.display="none",Z(o,a.key),e.messages.appendChild(n),e.messages.scrollTop=e.messages.scrollHeight)}),I=P(s,a=>{const o=document.getElementById(`msg-${a.key}`);o&&(o.remove(),e.messages.children.length<=2&&(e.emptyState.style.display="block"))});const i=e.chatInput.oninput;e.chatInput.addEventListener("input",()=>{if(!r||!d)return;e.chatInput.style.height="auto",e.chatInput.style.height=e.chatInput.scrollHeight+"px",e.chatInput.value.trim().length>0?(e.sendBtn.classList.remove("hidden"),e.recordBtn.classList.add("hidden")):(e.sendBtn.classList.add("hidden"),e.recordBtn.classList.remove("hidden"));const a=u(h,`rooms/${r}/typing/${d.uid}`);G(a,!0),J(a).remove(),clearTimeout(T),T=setTimeout(()=>{w(a)},2e3)}),F(t),X(),e.sendBtn.onclick=L}function F(t){const n=document.getElementById("typingIndicator");if(!n)return;const s=u(h,`rooms/${t}/typing`);x=K(s,i=>{const a=i.val();let o=!1;a&&Object.keys(a).forEach(g=>{g!==d.uid&&(o=!0)}),o?(n.classList.remove("hidden"),e.messages.scrollTop=e.messages.scrollHeight):n.classList.add("hidden")})}function ae(){const t=e.chatInput,n=e.sendBtn,s=e.recordBtn;t.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",this.value.trim().length>0?(n.classList.remove("hidden"),s.classList.add("hidden")):(n.classList.add("hidden"),s.classList.remove("hidden"))}),t.addEventListener("keydown",i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),L())}),n.addEventListener("click",L)}function L(){const t=e.chatInput.value.trim();t&&(v||(e.chatInput.value="",e.chatInput.style.height="auto",e.sendBtn.classList.add("hidden"),e.recordBtn.classList.remove("hidden"),$(t)))}function X(){const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t)return;c=new t,c.continuous=!1,c.interimResults=!1,c.onstart=()=>{y=!0,E(!0)},c.onend=()=>{y=!1,E(!1)},c.onerror=a=>{y=!1,E(!1)},c.onresult=a=>{const o=a.results[0][0].transcript;o&&o.trim().length>0&&$(o)};const n=e.recordBtn,s=a=>{if(a.preventDefault(),!(y||v)){c.lang=e.myLang.value;try{c.start()}catch(o){}}},i=a=>{a.preventDefault(),y&&c.stop()};n.addEventListener("mousedown",s),n.addEventListener("mouseup",i),n.addEventListener("touchstart",s),n.addEventListener("touchend",i)}function E(t){const n=e.recordBtn;t?(n.classList.add("bg-red-500","recording-pulse"),n.classList.remove("from-blue-600","to-purple-600")):(n.classList.remove("bg-red-500","recording-pulse"),n.classList.add("from-blue-600","to-purple-600"))}function $(t){return f(this,null,function*(){if(!d)return;v=!0,e.loadingOverlay.classList.remove("hidden");const n=e.myLang.value.split("-")[0],s=e.targetLang.value;try{const a=yield(yield fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,fromLang:n,toLang:s})})).json(),o={uid:d.uid,name:d.displayName||"User",photo:d.photoURL,original:t||"",translated:a.translatedText||t,pronunciation:a.transliteration||"",fromLang:n,toLang:s,timestamp:U()};yield j(u(h,`rooms/${r}/messages`),o)}catch(i){console.error(i)}finally{v=!1,e.loadingOverlay.classList.add("hidden")}})}function Z(t,n){const s=d&&t.uid===d.uid;let i="",a="";const o=t.pronunciation?`<div class="text-[10px] opacity-75 font-mono mt-0.5 pt-0.5 border-t border-white/10 inline-block">${t.pronunciation}</div>`:"";s?(i=`<div class="text-[15px] font-medium leading-relaxed">${t.original}</div>`,a=`
                    <div class="mt-2 pt-1 border-t border-white/20 text-xs text-blue-50 flex flex-col gap-0.5">
                        <div class="italic opacity-90 font-medium">${t.translated}</div>
                        ${o}
                    </div>`):(i=`<div class="text-[15px] font-medium leading-relaxed text-gray-800 dark:text-gray-100">${t.translated}</div>`,a=`
                    <div class="mt-2 pt-1 border-t border-gray-100 dark:border-gray-600 text-xs text-gray-500 dark:text-gray-400 flex flex-col gap-0.5">
                        <div class="italic">"${t.original}"</div>
                        ${o}
                    </div>`);const g=document.createElement("div");g.id=`msg-${n}`,g.className=`flex gap-2 animate-fade-in mb-4 group ${s?"flex-row-reverse":"flex-row"}`;const p=s?`
                <button onclick="deleteMessage('${n}')" class="opacity-0 group-hover:opacity-100 transition-opacity text-gray-300 hover:text-red-500 self-center px-2">
                    <i class="fas fa-trash-alt"></i>
                </button>`:"",m=s?"bg-blue-600 text-white rounded-br-none border-blue-600 shadow-blue-500/20":"bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none border-gray-200 dark:border-gray-600";g.innerHTML=`
                <img src="${t.photo}" class="w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 mt-auto shadow-sm object-cover bg-gray-200 dark:bg-gray-700">
                <div class="flex flex-col max-w-[85%] ${s?"items-end":"items-start"}">
                    <span class="text-[10px] text-gray-400 px-1 mb-0.5">${t.name}</span>
                    <div class="px-4 py-3 rounded-2xl shadow-sm border text-sm relative transition-all ${m}">
                        ${i}
                        ${a}
                    </div>
                </div>
                ${p}
            `,e.messages.appendChild(g),e.messages.scrollTop=e.messages.scrollHeight}window.deleteMessage=t=>f(null,null,function*(){if(!(!d||!r))try{yield w(u(h,`rooms/${r}/messages/${t}`))}catch(n){console.error(n)}});</script></body></html>